## 什么是tcp/ip
tcp/ip是包含了一系列构成互联网基础的网络协议。http协议就是基于tcp/ip协议传输的\
tcp/ip是一组不同层次上多个协议的组合，分为链路层，网络层，运输层和应用层，与osi七层模型对应\
**链路层**\
链路层需要处理ip与物理地址(mac)的映射关系，封装ip成帧，处理与传输媒介的接口等功能\
**网络层**\
网络层的功能是把分组发往目标网络可主机，这层包括ip协议，ICMP协议，以及IGMP协议\
ip协议是不可靠协议，为了尽快发送分组，可能会沿不同的路径进行分组传递，故分组的发送顺序和到达顺序可能不一样，需要上层做排序工作\
**传输层**\
传输层可以使源端主机与目标主机进行通话。该层有tcp协议和udp协议\
**应用层**\
应用层面对不同的网络将引入不同的的应用层协议，如http, ftp, dns等协议

http请求在发送时，http数据经过tcp/ip的每一层时，都会增加头部信息，有的协议层还在尾部信息，在到达目标主机的链路层后，
再次经过tcp/ip层，每经过一层都会去掉各层协议上的报文信息，最后得到http数据\
## tcp三次握手
tcp是面向连接的，提供可靠的连接服务\
- 第一次握手，客户端会发送一个SYN=1(代表想建立连接), ACK=0(确认码，为1代表确认收到链接),一个seq初始序列号x, ack=0(确认号，期望收到的包的序号从ack给的值开始)，发送完成后，客户端会进入SYN_SEND状态
- 第二次握手，服务端会发送一个ack=x+1（确认包，就是客户端的seq+1），一个SYN=1包，一个ACK=1包，一个seq=y, 服务端会进入SYN_REVD状态。第二次握手
其实验证了客户端的发送能力，服务端的接收和发送能力
- 第三次握手，客户端再次发送ack=y+1（y+1），seq=x+1, ACK=1,客户端进入ESTABLISHED状态，准备发送数据。服务端收到ACK包后，进入ESTABLISHED状态，准备接受数据
三次握手结束,验证了客户端的接收能力

**问：为什么要三次握手？**\
**如果是两次握手的话，在服务端发送完ACK确认包后，连接建立，若由于不明原因客户端的SYN包没有及时到达服务端，在SYN包过期后又传到了服务端，服务端以为是**
**客户端再一次发送了连接请求，故返回ACK包并建立连接，但客户端不认得这个ACK包，则不会理会，但连接已经建立，服务端依然等待客户端发送数据，这就导致资源浪费**\
**要三次握手也是验证了客户端和服务端的收发能力，第一次握手，客户端有发送能力，第二次，服务端有接收和发送能力，第三次，客户端有接收能力**
## tcp四次挥手
- 第一次挥手，浏览器会发关一个FIN包，一个seq初始序列号，通知服务端浏览器不再发送数据，并进入FIN_WAIT_1状态
- 第二次挥手，服务端收到断开连接的请求后，会发送一个ACK包=x+1(确认包，值为浏览器发送的seq+1)，客浏览器收到服务端ACK包后，
进入FIN_WAIT_2状态
- 第三次挥手，服务端发送完ACK包给浏览器后，还可以继续向浏览器发送数据，浏览器也可以继续接受数据，待服务端发送完数据后，
准备关闭连接，服务端会发送一个FIN包，seq=y给浏览器，并进入LAST_ACK状态
- 第四次回收，浏览器收到服务端的FIN包后，再次发送ACK=y+1包给服务端，并进入TIME_WAIT状态，服务端收到ACK包后，断开连接，
进入CLOSED状态，浏览器在等待一段时间后没有收到服务端的响应，也断开连接，进入CLOSED状态

**问：为什么要四次挥手？浏览器最后一次发送完ACK包后为什么需要等待2MSL?**\
**因为在断开连接时，服务端的FIN包和ACK确认包是分开发送的，这就比三次握手多了一次，若FIN包和ACK确认包一起发送，则客户端响应并关闭连接**
**服务端可能还有数据没有传输完毕，导致客户端不能完整收到**\
**而在网络差的情况下，第四次挥手，客户端发送的ACK确认包没有被服务端收到，会再次发送FIN包，客户端收到后，再次发送ACK确认包，在等待了**
**2MSL(msl, 报文在网络中最大的存活时间)认为服务端已经接收到ACK包并关闭连接，客户端也关闭连接**\
**同时，若已经失效的连接请求报文出现在新的连接中（新的请求可能走上一次请求的通道，所以可能出现过期的报文），在等待2MSL后，报文过期，新的连接就不会出现旧的连接请求报文**
## HTTP协议
### 什么是http
http是计算机网络通信的规则，是一种基于请求响应，无状态的应用层协议，常基于tcp/ip协议传输数据\
请求响应指的是客户端请求，服务端响应\
无状态是指连接断开后，服务端不会保留客户端的任何数据\
应用层指的是tcp/ip模型的应用层，http协议属于该层
### http请求报文
一般的http请求报文分为请求头，请求行，空行和请求数据\
**请求行**\
请求行包括了请求方法(8种，GET、POST、PUT、DELETE、PATCH、HEAD、OPTIONS、TRACE)，请求地址和协议版本(一般是http/1.0或http/1.1)\
**请求头**\
为请求报文添加一些附加信息，常见的有:\
Host: 服务器地址\
User-Agent: 发送请求的应用程序名称\
Connection: 指写连接相关的属性，如Connection:Keep-Alive\
Accept-Charset: 通知服务端可以发送的编码格式\
Accept-Encoding: 通知服务端可以发送的数据压缩格式\
请求头部的最后会有一个空行，表示请求头部结束\
**请求数据**\
可选部分，比如GET方法没有请求数据，post方法有请求数据
### http响应报文
一般的http响应头分为状态行、响应头部、空行以及响应数据\
**状态行**\
状态行包括了协议版本（与请求报文一致），状态码，状态描述\
1xx：指示信息--表示请求已接收，继续处理\
2xx：成功--表示请求已被成功接收、理解、接受\
3xx：重定向--要完成请求必须进行更进一步的操作\
4xx：客户端错误--请求有语法错误或请求无法实现\
5xx：服务器端错误--服务器未能实现合法的请求\
200（成功），302（跳转），403（拒绝访问），404（页面不存在），500（服务器内部错误），502（无效网关，可能是连接过多超时）\
**响应头**\
与请求头相似，常见的有:\
Serve: 服务器应用程序软件的名称和版本\
Content-Type: 响应正文的类型（图片还是二进制字符）\
Content-Length: 响应正文长度\
Content-Charset: 响应正文使用的编码\
Content-Encoding: 响应正文使用的数据压缩格式\
Content-Language: 响应正文使用的语言


